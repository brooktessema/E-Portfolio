<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Remote Sensing Projects – My E-Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">My E-Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./images/BTessema_Resume_E-Portfolio.pdf"> 
<span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-mgem-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">MGEM Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-mgem-projects">    
        <li>
    <a class="dropdown-item" href="./gis.html">
 <span class="dropdown-text">GIS and Spatial Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./rsensing.html">
 <span class="dropdown-text">Remote Sensing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./writing.html">
 <span class="dropdown-text">Writing &amp; Research</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#monitoring-mangrove-restoration-using-sentinel---2-imagery" id="toc-monitoring-mangrove-restoration-using-sentinel---2-imagery" class="nav-link active" data-scroll-target="#monitoring-mangrove-restoration-using-sentinel---2-imagery"><strong>Monitoring Mangrove Restoration Using Sentinel - 2 Imagery</strong></a></li>
  <li><a href="#lidar-data-processing-from-basics-to-tree-segmentation" id="toc-lidar-data-processing-from-basics-to-tree-segmentation" class="nav-link" data-scroll-target="#lidar-data-processing-from-basics-to-tree-segmentation"><strong>LiDAR Data Processing: From Basics to Tree Segmentation</strong></a></li>
  <li><a href="#exploring-urban-expansion-in-the-kitchener-waterloo-region-my-first-project" id="toc-exploring-urban-expansion-in-the-kitchener-waterloo-region-my-first-project" class="nav-link" data-scroll-target="#exploring-urban-expansion-in-the-kitchener-waterloo-region-my-first-project"><strong>Exploring Urban Expansion in the Kitchener-Waterloo Region: My First Project</strong></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Remote Sensing Projects</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Welcome to my Remote Sensing Projects page!</strong></p>
<p>In this section, you’ll find a collection of my remote sensing projects that reflect my journey from exploring geospatial data as an undergraduate to tackling advanced projects using programming languages R and Python. Remote Sensing is an essential tool for environmental management as it offers powerful tools to map, monitor, and manage Earth’s ecosystems.</p>
<hr>
<section id="monitoring-mangrove-restoration-using-sentinel---2-imagery" class="level3">
<h3 class="anchored" data-anchor-id="monitoring-mangrove-restoration-using-sentinel---2-imagery"><strong>Monitoring Mangrove Restoration Using Sentinel - 2 Imagery</strong></h3>
<p>As the capstone project of my Master’s program in Geomatics for Environmental Management (MGEM), this project is a significant culmination of my academic journey. For my project, I collaborated with <a href="https://blueventures.org/what-we-do/"><strong>Blue Ventures</strong></a>, a marine conservation organization focused on coastal ecosystem restoration, to study their mangrove restoration efforts in the Bay of Assassins, Madagascar. Using Sentinel-2 satellite imagery and <a href="https://blueventures.org/what-we-do/climate-solutions/blue-forests/gem/"><strong>GEM</strong></a>, a Google Earth Engine based tool, I mapped mangrove forests from 2019 to 2024, measuring changes in forest area and vegetation health.</p>
<p>My study investigates the question: <strong>To what extent can Sentinel-2 imagery detect changes in mangrove forest area and health at restoration sites in Madagascar?</strong> I answer this by quantifying mangrove vegetation changes, identifying areas of growth and loss, and assess vegetation health overtime. The focus on mangroves in restoration areas supports Blue Ventures’ mission to protect and restore mangroves in the region.</p>
<section id="tools-methods" class="level4">
<h4 class="anchored" data-anchor-id="tools-methods"><strong>Tools &amp; Methods:</strong></h4>
<ul>
<li><p><strong>Data</strong>: Sentinel-2 satellite imagery (2019–2024), Mangrove Restoration sites in Madagascar</p></li>
<li><p><strong>Tools</strong>: Google Earth Engine (GEM v2) for time-series analysis, QGIS &amp; ArcGIS Pro for mapping and visualizations</p></li>
<li><p><strong>Analysis</strong>:</p>
<ul>
<li><p>Quantify changes in mangrove extent over time.</p></li>
<li><p>Identify areas of significant growth and loss.</p></li>
<li><p>Assess vegetation health using spectral indices (NDVI,).</p></li>
</ul></li>
</ul>
<p>My full report will be available here once the project ends, but I’ve summarized and visualized some of my results below.</p>
</section>
<section id="key-results" class="level4">
<h4 class="anchored" data-anchor-id="key-results"><strong>Key Results:</strong></h4>
</section>
<section id="map-of-mangroves-in-bay-of-assassins-from-2019-2024-showing-changes-in-area-overtime." class="level4">
<h4 class="anchored" data-anchor-id="map-of-mangroves-in-bay-of-assassins-from-2019-2024-showing-changes-in-area-overtime."><img src="images/Layout.jpg" class="img-fluid" width="870" alt="Map of Mangroves in Bay of Assassins from 2019-2024 showing changes in area overtime."></h4>
</section>
<section id="reflection" class="level4">
<h4 class="anchored" data-anchor-id="reflection"><strong>Reflection:</strong></h4>
<p>This project was a deeply rewarding experience that not just expanded my knowledge and technical skills but also connected me to a cause I deeply care about. Growing up in Ethiopia, I have always I’ve always felt a strong pull toward supporting environmental conservation in Africa, and this project gave me the chance to do just that. Working with Blue Ventures and local partners in Madagascar, I saw firsthand the real-world impact of our research helping to restore mangrove ecosystems that are vital for coastal protection and biodiversity. Beyond the technical skills in GIS and remote sensing, I learned so much about time management, communication, and succesful client engagement. Overall, this Capstone project was an enriching experience that allowed me to combine technical expertise with a passion for positive change. I feel fortunate to have worked on something so impactful and meaningful, and this project has further strengthened my commitment to supporting environmental and sustainability efforts worldwide.</p>
</section>
<section id="skills-gained" class="level4">
<h4 class="anchored" data-anchor-id="skills-gained"><strong>Skills Gained:</strong></h4>
<ul>
<li><p>Satellite Imagery Analysis (Sentinel-2)</p></li>
<li><p>Time-Series Analysis (Google Earth Engine)</p></li>
<li><p>Mangrove Vegetation Change Detection</p></li>
<li><p>Vegetation Health Assessment (NDVI)</p></li>
<li><p>Data Classification and Visualization</p></li>
<li><p>Environmental Monitoring &amp; Reporting</p></li>
</ul>
<hr>
</section>
</section>
<section id="lidar-data-processing-from-basics-to-tree-segmentation" class="level3">
<h3 class="anchored" data-anchor-id="lidar-data-processing-from-basics-to-tree-segmentation"><strong>LiDAR Data Processing: From Basics to Tree Segmentation</strong></h3>
<p>I first encountered LiDAR data during our graduate program orientation, where I was blown away by 3D visualizations created captured from a drone flight. This moment sparked my excitement to dive into the world of LiDAR and explore what seemed like unlimited potential.</p>
<p><strong>Getting Hands-On with LiDAR</strong></p>
<p>In this assignment, I learned how to process LiDAR data in R to create a Canopy Height Model (CHM), or as I like to call it, “tree height map.” The goal was to familiarize myself with handling .las files, working with multiple tiles, and extracting point clouds from specific forest plots. I generated digital elevation models (DEMs) and CHMs to visualize tree heights and analyzed plot-level metrics to describe vegetation structure. It was a great introduction to organizing data, normalizing point clouds, and creating useful forestry products. Below are images of Digital Elevation and Canopy Height Models I was able to generate from LiDAR data. It may not look like much in this form but using these layers we were able to analyze terrain features, assess vegetation structure, and enhance our understanding of the landscape and it composition from the comfort of the computer lab.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-720882863.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="845"></p>
</figure>
</div>
<p><strong>Individual Tree Segmentation</strong></p>
<p>The second assignment took me to the next level, where I worked with LiDAR data from the Malcolm Knapp Research Forest to identify individual trees. Using the <a href="https://r-lidar.github.io/lidRbook/">lidR</a> package in R, I compared algorithms for tree detection by analyzing point clouds and CHMs. I fine-tuned parameters to improve results and deepened my understanding of segmentation methods through practical questions.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-1212403005.png" class="img-fluid figure-img" width="505"></p>
<figcaption>Individual Segmented Trees using LiDar data</figcaption>
</figure>
</div>
<section id="reflection-1" class="level4">
<h4 class="anchored" data-anchor-id="reflection-1"><strong>Reflection:</strong></h4>
<p>It’s incredible to see how quickly I progressed from a curious observer to someone who can process and segment LiDAR data to identify individual trees. Each step, from mapping terrain to identifying individual trees, has expanded my understanding of LiDAR’s potential in forestry and beyond. I’m excited to continue exploring this technology’s applications in environmental monitoring.</p>
</section>
<section id="skills-gained-1" class="level4">
<h4 class="anchored" data-anchor-id="skills-gained-1"><strong>Skills Gained:</strong></h4>
<ul>
<li><p>LiDAR Data Processing</p></li>
<li><p>Canopy Height Model (CHM) Creation</p></li>
<li><p>Point Cloud Classification</p></li>
<li><p>Tree Segmentation</p></li>
<li><p>Algorithm Comparison</p></li>
<li><p>R Programming (lidR package)</p></li>
</ul>
<hr>
</section>
</section>
<section id="exploring-urban-expansion-in-the-kitchener-waterloo-region-my-first-project" class="level3">
<h3 class="anchored" data-anchor-id="exploring-urban-expansion-in-the-kitchener-waterloo-region-my-first-project"><strong>Exploring Urban Expansion in the Kitchener-Waterloo Region: My First Project</strong></h3>
<p>Reflecting on this project always brings me back to the early days of my remote sensing journey. It was during my undergraduate years, when I first introduced to the field of geomatics, and intrigued by the idea of examining the world from a distance and without physical contact a.k.a “remote sensing”. This project marked the beginning of my journey in remote sensing and how satellite imagery can reveal changes in the world over time.</p>
<p>For this project, I used Landsat images from 1990 to 2020 to visualize and quantify how urban land cover had changed over the 30-year period. I used an ISODATA unsupervised classification algorithm to categorize the images into four land cover classes: vegetation, water, built-up areas, and barren cropland. I then performed a bi-temporal change detection analysis to identify urban expansion. The results revealed a 16.5% increase in the urban landscape, mostly replacing barren cropland. In my figure below yellow circles indicate some of the areas in which major urban expansion occurred. This urban sprawl was driven by rapid population growth, and the spatial pattern was scattered, emphasizing the need for monitoring urban growth to reduce its environmental impact.</p>
<section id="results" class="level4">
<h4 class="anchored" data-anchor-id="results"><strong>Results:</strong></h4>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 49%">
</colgroup>
<tbody>
<tr class="odd">
<td><img src="images/before.jpg" class="img-fluid" width="453"></td>
<td><img src="images/after.jpg" class="img-fluid" width="448"></td>
</tr>
</tbody>
</table>
</section>
<section id="reflection-2" class="level4">
<h4 class="anchored" data-anchor-id="reflection-2"><strong>Reflection:</strong></h4>
<p>Looking at this project now, I can’t help but reflect on how much I’ve grown in the remote sensing field. At the time, I was just starting to understand the process, working with image classification but without any coding. Today, I’m able to tackle much more complex analyses and understand the underlying principles more deeply.</p>
</section>
<section id="skills-gained-2" class="level4">
<h4 class="anchored" data-anchor-id="skills-gained-2"><strong>Skills Gained:</strong></h4>
<ul>
<li><p>Image Classification</p></li>
<li><p>Change Detection Analysis</p></li>
<li><p>Geo-spatial Analysis</p></li>
<li><p>Report Writing</p></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>